#!/bin/env cmsRun

process combinedsv = {
    include "FWCore/MessageLogger/data/MessageLogger.cfi"
    # replace MessageLogger.cerr.default.limit = 1000000
    replace MessageLogger.debugModules = { "cVRTest" }

    source = PoolSource {
      # untracked vstring fileNames = { "file:bb.root"}
      untracked vstring fileNames = { '/store/mc/2007/11/15/RelVal-RelValBJets_Pt_50_120-1195137779/0000/30B9C9DC-E493-DC11-A420-001617C3B65A.root' }
    }

    untracked PSet maxEvents = {untracked int32 input = 2 }

    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    # include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
    include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"
    include "RecoVertex/PrimaryVertexProducer/data/OfflinePrimaryVerticesFromCTFTracks.cfi"

    // replace offlinePrimaryVerticesFromCTFTracks.useBeamConstraint = true
    // include "RecoVertex/Configuration/data/RecoVertex.cff"
    include "RecoJets/JetProducers/data/BasicJetIcone5.cfi"
    # include "RecoJets/JetProducers/data/iterativeJetIcone5.cfi"
    include "RecoJets/JetAssociationProducers/data/ic5JetTracksAssociatorAtVertex.cfi"
    # include "RecoBTag/CombinedSV/test/trackcounting.cfi"
    include "RecoBTag/CombinedSV/data/combined.cff"

    # module execution
# path p = { iterativeCone5BasicJets, ic5JetTracksAssociatorAtVertex, offlinePrimaryVerticesFromCTFTracks, combinedSVBJetTags }

    module cVRTest = CVRTest
    {
      string trackcoll = "ctfWithMaterialTracks"
      PSet vertexreco =
      {
        string finder = "avr"
        double weightthreshold=0.0
        double primcut = 1.8
        double seccut = 6.0
        double minweight = 0.5
        bool smoothing = false
      }
    }

    path p = { cVRTest }

    module out = PoolOutputModule {
      untracked string fileName = "file:jettags_small.root"
      # type_label_instance_process
      untracked vstring outputCommands = { "drop *", "keep edmHepMCProduct_source_*_*", "keep *_combinedSVBJetTags_*_*", "keep *_combinedSVMVABJetTags_*_*", "keep *_jetProbabilityBJetTags_*_*", "keep *_trackCountingHighEffBJetTags_*_*" }
      # untracked vstring outputCommands = { "drop recoCombinedSVTagInfos_combinedSVBJetTags_*_*" }
    }

    endpath outpath = { out }
}
